{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Play Game | ClueLess</title>

    <!-- Bootstrap -->
    <!-- Latest compiled and minified CSS -->
    <!-- Bootstrap Core CSS -->
    <link href="{% static 'clueless/css/bootstrap.min.css' %}"  rel="stylesheet">
    <!-- Custom Styles -->
    <link href="{% static 'clueless/css/styles.css' %}"  rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">

    {% include "clueless/defaultNavbar.html" %}
    <div class="container" style="margin-top:60px">
        <div class="row">
            <div class="col-md-9">
                <canvas id="clueless" width="100%"></canvas>
            </div>
            <div class="col-md-3">
                <div id="actionBar"></div>
            </div>
        </div>
        <div id="detectiveSheet"></div>
    </div>


    <!-- jQuery -->
    <script src="{% static 'clueless/js/jquery.js' %}"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="{% static 'clueless/js/bootstrap.min.js' %}"></script>

    <!-- Scrolling Nav JavaScript -->
    <script src="{% static 'clueless/js/jquery.easing.min.js' %}"></script>

    <!-- App Specific JS -->
    <script src="{% static 'clueless/js/game.js' %}"></script>

    <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>
    <script src="https://code.createjs.com/preloadjs-0.6.2.min.js"></script>

    <script type="text/javascript">
    //Define global variables
    var cached_game_seq = -1;
    var stage;
    var canvas;
    var players = [];

    //Define the space locations from the database
	var spaceLocations = [
		{% for space in spaces %}
		[{{space.id}},{{space.posX}},{{space.posY}}],
		{% endfor %}
	];

    function init() {
        //Load image background
        img = new Image();
        img.onload = loadImage;
        img.src = "{% static 'clueless/images/GridBackground.png' %}";

        //Call game state in 1 second intervals
        setInterval(function(){
            getGameState("{% url 'gamestate' %}", {{game.id}}, {{player.id}}, cached_game_seq);
            }, 1000
        );
    }

    function loadImage() {
        //Locate canvas and load image
        canvas = document.getElementById('clueless');

        //Create stage to load image
        stage = new createjs.Stage(canvas);

        //Define scaling variables
        canvasScaleX = Math.round((canvas.width/1500) * 100) / 100;
        canvasScaleY = Math.round((canvas.height/1500) * 100) / 100;

		//Scale from 1500x1500 image
        var bmp = new createjs.Bitmap(img).set({scaleX: canvasScaleX, scaleY: canvasScaleY});
        stage.addChild(bmp);

        //Draw frame
        stage.update();
    }

    function loadActionBar()
    {
        //Define the action bar URL
        var url = "{% url 'playerturn' game.id %}";
        //Retrieve the HTML and load it
        $.get( url , function( data ) {
            $( "#actionBar" ).html( data );
        });
    }

    function loadDetectiveSheet(){
        loadDetectiveSheet("");
    }

    function loadDetectiveSheet(notes)
    {
        //Define the action bar URL
        var url = "{% url 'detectivesheet' game.id player.id %}";
        //Retrieve the HTML and load it
        $.get( url , function( data ) {
            $( "#detectiveSheet" ).html( data );
            $('#detectiveSheetNotes').val(notes);
        });
    }

    //The function that gets called when the page loads
    $(document).ready(function(){
        //Load the content bar -- can be reloaded as needed
        loadActionBar();
        loadDetectiveSheet();
        //Update canvas size
        var ctx = document.getElementById('clueless').getContext('2d');
        //Set both to width, to keep it square
        ctx.canvas.width = innerWidth;
        ctx.canvas.height = innerWidth;
        //Load background images
        init();
    });
    </script>
  </body>
</html>
